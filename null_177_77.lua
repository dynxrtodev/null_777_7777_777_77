---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181
---77787877871817181817181717118718118171818198191819181

local Booth = { 
  running = false,
  delay = 2000,
  itemid = 112,
  lastActionTime = 0
  }

local Shop  = { running = false, 
  delay = 2000, itemid = 1796,
  lastActionTime = 0 
  
}

local UT = {
    running = false, delay = 2000,
    tilex = 4, tiley = 48,
    removeItem = 200, dropItem = 16956, dropCount = 200,
    lastActionTime = 0
}

local ADDVEND = { running = false,
  tilex = 48,
  tiley = 36,
  price = 1, 
  perlock = 0, 
  peritem = 1, 
  delay = 2000, 
  lastActionTime = 0 
  }

local PNB = {
    running = false,
    far = 10, 
    itemId = 17092, 
    direction = "right",
    delay = 10, 
    state = 0, 
    index = 1
}

local VENDING = {
    running = false,
    shopWorld = "nice", 
    dropWorld = "svms",
    itemid = 3207,
    buycount = 200,
    tilex = 10, 
    tiley = 46, 
    dropx = 10, 
    dropy = 46,
    state = 0, 
    lastActionTime = 0,
    actionDelay = 1000
}

local PLANT = {
    running = false, 
    seedid = 17093,
    TakeSeed_X = 11, 
    TakeSeed_Y = 44,
    X_MIN = 1,
    X_MAX = 98,
    Y_MIN = 0,
    Y_MAX = 20,
    currentX = nil, 
    currentY = nil, 
    plantDelay = 300, 
    lastPlantTime = 0, 
    logInterval = 10
}

local MIRRORMAZE = {
    running = false,
    paused = false,
    doorX = 26,
    doorY = 22, 
    targetX = 24,
    targetY = 24,
    state = 0,
    count = 0, 
    actionDelay = 200, 
    lastActionTime = 0
}

local DAW = {
    wl = 242,
    dl = 1796, 
    bgl = 7188, 
    delay = 200
}

--- U
local function logMessage(msg)
    LogToConsole("`c[ SVMS ] `w" .. tostring(msg))
    SendVariantList({[0] = "OnTextOverlay", [1] = "`c[ SVMS ] : " .. tostring(msg)})
end

local function GetItemCount(itemID)
    local inv = GetInventory()
    if not inv then return 0 end
    for _, it in pairs(inv) do
        if it.id == itemID then return it.amount end
    end
    return 0
end

local function worldEquals(name)
    local wn = GetWorldName()
    if not wn then return false end
    return wn:lower() == (name or ""):lower()
end

local function IsOtherPlayerNearby()
    local me = GetLocal()
    if not me then return false, nil end
    for _, p in pairs(GetPlayerList()) do
        if p.netid ~= me.netid then
            return true, p.name
        end
    end
    return false, nil
end

--- D
local function ShowSVMSDialog()
    local dialog = [[
set_default_color|`o
add_label_with_icon|big|`cSVMS HELPER! `2< v1.2 >|left|32|
add_label_with_icon|small|`cServer : `9GTFY!|right|6336|
add_spacer|small|
add_image_button|banner|game/gtfy_carnival.rttex|bannerlayout||
add_spacer|small|
add_separator|

add_label_with_icon|small|`cSVMS New Updates!|left|6018|
add_smalltext|`wSeptember 15, 2025:|left|
add_smalltext|`2>>  Optimized core loops for better performance and lower FPS impact.|left|
add_smalltext|`2>>  Improved state management for Vending, Mirrormaze, PNB, and Plant features.|left|
add_smalltext|`2>>  Add /daw command.|left|
add_smalltext|`2>>  Reduced excessive logging for Plant feature.|left|
add_smalltext|`2>>  More robust handling of player position and world changes.|left|
add_smalltext|`2>>  Bug fixes & performance improvements|left|
add_spacer|small|
add_separator|

add_label_with_icon|small|`eAutomation Features|left|3682|
add_smalltext|`2/booth `7-> Auto Buy Gems from Booth|left|
add_smalltext|`2/boothitem <itemID> `7-> Set itemID|left|
add_smalltext|`2/mirrormaze `7-> Auto Mirrormaze Solving|left|
add_smalltext|`2/mirrormaze door <x> <y> `7-> Set door coordinate|left|
add_smalltext|`2/mirrormaze target <x> <y> `7-> Set target coordinate|left|
add_smalltext|`2/shop <itemID> `7-> Auto Buy from Gems Store|left|
add_smalltext|`2/vending `7-> Auto Vending Menu|left|
add_smalltext|`2/vending start|stop `7-> Start/Stop vending cycle|left|
add_smalltext|`2/venditem <id> <count> `7-> Set item & amount|left|
add_smalltext|`2/vendxy <x> <y> `7-> Set vending pos|left|
add_smalltext|`2/dropxy <x> <y> `7-> Set drop pos|left|
add_smalltext|`2/vendworld <shop> <drop> `7-> Set worlds|left|
add_smalltext|`2/addvend `7-> Auto Add Stock|left|
add_smalltext|`2/addvendxy <x> <y> `7-> Set vending pos|left|
add_smalltext|`2/ut `7-> Auto Retrieve UT + drop|left|
add_smalltext|`2/ut xy <x> <y> `7-> Set ut/gaia pos|left|
add_smalltext|`2/ut item <removeItems> <itemID> <dropItems>`7-> Set Removing Count itemID, Dropping Count|left|
add_smalltext|`2/pnb `7-> Auto Place & Break blocks up to 8 far!|left|
add_smalltext|`2/plant start|stop `7-> Start/Stop plant cycle|left|
add_smalltext|`2/plant id < Seed ID > `7-> Set Seed ID|left|
add_smalltext|`2/plant x < from x > < to x > `7-> Set x to x world|left|
add_smalltext|`2/plant y < from y > < to y > `7-> Set y to y world|left|
add_spacer|small|
add_separator|

add_label_with_icon|small|`9Lock Helper|left|1796|
add_smalltext|`2/dwl <amount> `7-> Drop WLs|left|
add_smalltext|`2/ddl <amount> `7-> Drop DLs|left|
add_smalltext|`2/dbgl <amount> `7-> Drop BGLs|left|
add_smalltext|`2/deposit <amount> `7-> Deposit BGLs to bank|left|
add_smalltext|`2/wd <amount> `7-> Withdraw BGLs|left|
add_spacer|small|
add_separator|

add_label_with_icon|small|`eExtra Tools|left|9474|
add_smalltext|`2/donate <amount> `7-> Support the developer!|left|
add_smalltext|`2/helpsv `7-> Show this help menu|left|
add_spacer|small|
add_separator|
add_image_button|svms_dc|interface/gtps/discord.rttex|3imageslayout|https://discord.gg/gePbgrZX|Do you want to join our `cDISCORD SERVER``?|
add_button_with_icon||END_LIST|noflags|0||
add_spacer|small|
add_label_with_icon|small|`wPowered By: `e@Seventyn|left|3732|
add_label_with_icon|small|`wJoin Our Discord Server For More Information!|left|28|
add_spacer|small|
end_dialog|gazette||OK|
add_quick_exit
]]
    SendVariantList({[0] = "OnDialogRequest", [1] = dialog})
end

--- H
AddHook("OnSendPacket", "SVMS_Commands", function(type, packet)
    if type ~= 2 then return end
    local text = packet:match("text|(.+)")
    if not text then return end

    local args = {}
    for w in text:gmatch("%S+") do table.insert(args, w) end
    local cmd = args[1] or ""
    local a2  = args[2] or ""
    local a3  = args[3] or ""
    local a4  = args[4] or ""
    local a5  = args[5] or ""

    if cmd == "/helpsv" then
        ShowSVMSDialog()
        return true
    end

    if cmd == "/booth" then
        if tonumber(a2) then
            Booth.delay = tonumber(a2)
            logMessage("Booth delay set -> " .. Booth.delay .. " ms")
        else
            Booth.running = not Booth.running
            Booth.lastActionTime = os.clock() * 1000
            logMessage(Booth.running and "Booth started" or "Booth stopped")
        end
        return true
    end
    
    if cmd == "/boothitem" then
    if tonumber(a2) then
        local id = tonumber(a2)
        if id and id > 0 then
            Booth.itemid = id
            logMessage("Booth itemID updated -> "..id)
        else
            logMessage("Usage: /boothitem <itemID>")
        end
    else
        logMessage("Usage: /boothitem <itemID>")
    end
    return true
end

    if cmd == "/shop" then
        if tonumber(a2) then
            Shop.itemid = tonumber(a2)
            logMessage("Shop item set -> " .. Shop.itemid)
        else
            Shop.running = not Shop.running
            Shop.lastActionTime = os.clock() * 1000
            logMessage(Shop.running and "Shop started" or "Shop stopped")
        end
        return true
    end

    if cmd == "/ut" then
        if a2 == "xy" and tonumber(a3) and tonumber(a4) then
            UT.tilex = tonumber(a3); UT.tiley = tonumber(a4)
            logMessage("UT pos set -> "..UT.tilex..","..UT.tiley)
        elseif a2 == "item" and tonumber(a3) and tonumber(a4) and tonumber(a5) then
            UT.removeItem = tonumber(a3); UT.dropItem = tonumber(a4); UT.dropCount = tonumber(a5)
            logMessage("UT items set -> remove:"..UT.removeItem.." drop:"..UT.dropItem.." count:"..UT.dropCount)
        else
            UT.running = not UT.running
            UT.lastActionTime = os.clock() * 1000
            logMessage(UT.running and "UT started" or "UT stopped")
        end
        return true
    end

    if cmd == "/addvend" then
        if a2 == "start" then
            ADDVEND.running = true
            logMessage("AddVend started")
        elseif a2 == "stop" then
            ADDVEND.running = false
            logMessage("AddVend stopped")
        else
            logMessage("Usage: /addvend start|stop")
        end
        return true
    end
    if cmd == "/addvendxy" then
        local x = tonumber(a2); local y = tonumber(a3)
        if x and y then ADDVEND.tilex = x; ADDVEND.tiley = y; logMessage("AddVend pos updated -> "..x..","..y)
        else logMessage("Usage: /addvendxy <x> <y>") end
        return true
    end

    if cmd == "/pnb" then
        local f = tonumber(a2); local id = tonumber(a3); local dir = a4; local dlay = tonumber(a5)
        if f and id and (dir == "left" or dir == "right") then
            PNB.far = f; PNB.itemId = id; PNB.direction = dir
            if dlay then PNB.delay = dlay end
            PNB.running = not PNB.running
            PNB.state = 0; PNB.index = 1
            logMessage(PNB.running and ("PNB started far="..PNB.far.." id="..PNB.itemId.." dir="..PNB.direction.." delay="..PNB.delay)
                                or "PNB stopped")
        else
            logMessage("Usage: /pnb <far> <itemId> <left/right> <delay(ms)>")
        end
        return true
    end

    if cmd == "/vending" then
        if a2 == "start" then VENDING.running = true; VENDING.state = 0; VENDING.lastActionTime = os.clock()*1000; logMessage("Vending started")
        elseif a2 == "stop" then VENDING.running = false; logMessage("Vending stopped")
        else logMessage("Usage: /vending start|stop") end
        return true
    end
    if cmd == "/venditem" then local id = tonumber(a2); local cnt = tonumber(a3)
        if id and cnt then VENDING.itemid = id; VENDING.buycount = cnt; logMessage("Vending item set -> "..id.." x"..cnt) end; return true
    end
    if cmd == "/vendxy" then local x = tonumber(a2); local y = tonumber(a3)
        if x and y then VENDING.tilex = x; VENDING.tiley = y; logMessage("Vending pos set -> "..x..","..y) end; return true
    end
    if cmd == "/dropxy" then local x = tonumber(a2); local y = tonumber(a3)
        if x and y then VENDING.dropx = x; VENDING.dropy = y; logMessage("Drop pos set -> "..x..","..y) end; return true
    end
    if cmd == "/vendworld" then if a2 and a3 then VENDING.shopWorld = a2; VENDING.dropWorld = a3; logMessage("Vending worlds set -> shop:"..a2.." drop:"..a3) end; return true end

    if cmd == "/plant" then
        if a2 == "start" then PLANT.running = true; PLANT.currentX = PLANT.X_MIN; PLANT.currentY = PLANT.Y_MIN; logMessage("Plant started")
        elseif a2 == "stop" then PLANT.running = false; logMessage("Plant stopped")
        elseif a2 == "x" and tonumber(a3) and tonumber(a4) then PLANT.X_MIN=tonumber(a3); PLANT.X_MAX=tonumber(a4); logMessage("Plant X set -> "..PLANT.X_MIN.." - "..PLANT.X_MAX)
        elseif a2 == "y" and tonumber(a3) and tonumber(a4) then PLANT.Y_MIN=tonumber(a3); PLANT.Y_MAX=tonumber(a4); logMessage("Plant Y set -> "..PLANT.Y_MIN.." - "..PLANT.Y_MAX)
        elseif a2 == "id" and tonumber(a3) then PLANT.seedid = tonumber(a3); logMessage("Plant seed id -> "..PLANT.seedid)
        else logMessage("Usage: /plant start|stop|x <min> <max>|y <min> <max>|id <itemID>") end
        return true
    end

    if cmd == "/mirrormaze" then
        if a2 == "start" then MIRRORMAZE.running = true; MIRRORMAZE.paused=false; MIRRORMAZE.state=0; MIRRORMAZE.count=0; logMessage("Mirrormaze started")
        elseif a2 == "stop" then MIRRORMAZE.running = false; logMessage("Mirrormaze stopped")
        elseif a2 == "door" and tonumber(a3) and tonumber(a4) then MIRRORMAZE.doorX=tonumber(a3); MIRRORMAZE.doorY=tonumber(a4); logMessage("Mirrormaze door -> "..a3..","..a4)
        elseif a2 == "target" and tonumber(a3) and tonumber(a4) then MIRRORMAZE.targetX=tonumber(a3); MIRRORMAZE.targetY=tonumber(a4); logMessage("Mirrormaze target -> "..a3..","..a4)
        else logMessage("Usage: /mirrormaze start|stop|door x y|target x y") end
        return true
    end
    
    local amount = tonumber(num) or 1
    if cmd == "/dbgl" then
        SendPacket(2, "action|dialog_return\ndialog_name|drop_item\nitemID|7188|\ncount|"..amount)
        logMessage("Dropped "..amount.." BGL")
        return true
    end
    if cmd == "/ddl" then
        SendPacket(2, "action|dialog_return\ndialog_name|drop_item\nitemID|1796|\ncount|"..amount)
        logMessage("Dropped "..amount.." DL")
        return true
    end
    if cmd == "/dwl" then
        SendPacket(2, "action|dialog_return\ndialog_name|drop_item\nitemID|242|\ncount|"..amount)
        logMessage("Dropped "..amount.." WL")
        return true
    end
    if cmd == "/deposit" then
        local pkt = "action|dialog_return\n" ..
                    "dialog_name|my_bank_account\n" ..
                    "buttonClicked|depo_true\n" ..
                    "bgl_|"..amount
        SendPacket(2, pkt)
        logMessage("Deposited "..amount.." BGL")
        return true
    end
    if cmd == "/wd" then
        local pkt = "action|dialog_return\n" ..
                    "dialog_name|my_bank_account\n" ..
                    "buttonClicked|wd_true\n" ..
                    "wd_|"..amount
        SendPacket(2, pkt)
        logMessage("Withdrew "..amount.." BGL")
        return true
    end
    local function dropItem(id, count)
    if count <= 0 then return end
    local pkt = "action|dialog_return\n" ..
                "dialog_name|drop_item\n" ..
                "itemID|"..id.."|\n" ..
                "count|"..count
    SendPacket(2, pkt)
end

local function getAmount(id)
    local inv = GetInventory()
    if not inv then return 0 end
    for _, item in pairs(inv) do
        if item.id == id then
            return item.amount
        end
    end
    return 0
end

if cmd == "/daw" then
    RunThread(function()
        local totalWL  = getAmount(DAW.wl)
        local totalDL  = getAmount(DAW.dl)
        local totalBGL = getAmount(DAW.bgl)

        if totalWL == 0 and totalDL == 0 and totalBGL == 0 then
            logMessage("`e[ SVMS ] No WL/DL/BGL found in inventory.")
            return
        end

        logMessage("`e[ SVMS ] Dropping all wealth...")

        if totalWL > 0 then
            logMessage("`e[ SVMS ] `8Dropping "..totalWL.." WL(s)...")
            dropItem(DAW.wl, totalWL)
            Sleep(DAW.delay)
        end
        if totalDL > 0 then
            logMessage("`e[ SVMS ] `cDropping "..totalDL.." DL(s)...")
            dropItem(DAW.dl, totalDL)
            Sleep(DAW.delay)
        end
        if totalBGL > 0 then
            logMessage("`e[ SVMS ] Dropping "..totalBGL.." BGL(s)...")
            dropItem(DAW.bgl, totalBGL)
            Sleep(DAW.delay)
        end

        logMessage("`e[ SVMS ] All WL/DL/BGL dropped successfully.")
    end)
    return true
end
    if cmd == "/donate" then
        RunThread(function()
            SendPacket(3, "action|join_request\nname|svms\ninvitedWorld|0")
            Sleep(1500)
            local pkt = "action|dialog_return\n" ..
                        "dialog_name|give_item\n" ..
                        "itemID|7188|\n" ..
                        "tilex|49|\n" ..
                        "tiley|35|\n" ..
                        "buttonClicked|give\n" ..
                        "count|"..amount.."|\n" ..
                        "sign_text|"
            SendPacket(2, pkt)
            logMessage("Thanks For The Support!")
        end)
        return true
    end
    return
end)

--- F
RunThread(function()
    while true do
        local currentTime = os.clock() * 1000
        local me = GetLocal()
        local px, py
        if me then px = math.floor(me.pos.x / 32); py = math.floor(me.pos.y / 32) end

        if VENDING.running then
            if (currentTime - VENDING.lastActionTime) >= VENDING.actionDelay then
                if VENDING.state == 0 then
                    logMessage("Vending: joining shop "..VENDING.shopWorld)
                    SendPacket(3, "action|join_request\nname|" .. VENDING.shopWorld .. "\ninvitedWorld|0")
                    VENDING.state = 1
                    VENDING.lastActionTime = currentTime
                    VENDING.actionDelay = 2000
                elseif VENDING.state == 1 then
                    if worldEquals(VENDING.shopWorld) then
                        logMessage("Vending: going to vending at "..VENDING.tilex..","..VENDING.tiley)
                        FindPath(VENDING.tilex, VENDING.tiley)
                        VENDING.state = 2
                        VENDING.lastActionTime = currentTime
                        VENDING.actionDelay = 800
                    else
                        logMessage("Vending: not in shop yet, retry join")
                        SendPacket(3, "action|join_request\nname|" .. VENDING.shopWorld .. "\ninvitedWorld|0")
                        VENDING.lastActionTime = currentTime
                        VENDING.actionDelay = 1500
                    end
                elseif VENDING.state == 2 then
                    logMessage("Vending: buying "..VENDING.buycount.." item "..VENDING.itemid)
                    local pktBuy = "action|dialog_return\n" ..
                                   "dialog_name|vending\n" ..
                                   "tilex|"..VENDING.tilex.."|\n" ..
                                   "tiley|"..VENDING.tiley.."|\n" ..
                                   "expectprice|1|\n" ..
                                   "expectitem|"..VENDING.itemid.."|\n" ..
                                   "verify|1|\n"..
                                   "buycount|"..VENDING.buycount
                    SendPacket(2, pktBuy)
                    VENDING.state = 3
                    VENDING.lastActionTime = currentTime
                    VENDING.actionDelay = 1000
                elseif VENDING.state == 3 then
                    logMessage("Vending: join drop world "..VENDING.dropWorld)
                    SendPacket(3, "action|join_request\nname|" .. VENDING.dropWorld .. "\ninvitedWorld|0")
                    VENDING.state = 4
                    VENDING.lastActionTime = currentTime
                    VENDING.actionDelay = 2000
                elseif VENDING.state == 4 then
                    if worldEquals(VENDING.dropWorld) then
                        logMessage("Vending: going to drop pos "..VENDING.dropx..","..VENDING.dropy)
                        FindPath(VENDING.dropx, VENDING.dropy)
                        VENDING.state = 5
                        VENDING.lastActionTime = currentTime
                        VENDING.actionDelay = 800
                    else
                        logMessage("Vending: not in drop world yet, retry join")
                        SendPacket(3, "action|join_request\nname|" .. VENDING.dropWorld .. "\ninvitedWorld|0")
                        VENDING.lastActionTime = currentTime
                        VENDING.actionDelay = 2000
                    end
                elseif VENDING.state == 5 then
                    logMessage("Vending: dropping "..VENDING.buycount.." item "..VENDING.itemid)
                    local pktDrop = "action|dialog_return\n" ..
                                    "dialog_name|drop_item\n" ..
                                    "itemID|"..VENDING.itemid.."|\n" ..
                                    "count|"..VENDING.buycount
                    SendPacket(2, pktDrop)
                    VENDING.state = 0
                    VENDING.lastActionTime = currentTime
                    VENDING.actionDelay = 500
                end
            end
        end

        -- BOOTH
        if Booth.running then
            if currentTime - Booth.lastActionTime >= Booth.delay then
                SendPacket(2, "action|dialog_return\ndialog_name|carnival_booth\ntilex|65|\ntiley|53|\nbuttonClicked|buy_"..Booth.itemid)
                Booth.lastActionTime = currentTime
            end
        end

        -- SHOP
        if Shop.running then
            if currentTime - Shop.lastActionTime >= Shop.delay then
                SendPacket(2, "action|buy\nitem|"..Shop.itemid)
                Shop.lastActionTime = currentTime
            end
        end

        -- UT
        if UT.running then
            if currentTime - UT.lastActionTime >= UT.delay then
                SendPacket(2, "action|dialog_return\ndialog_name|itemremovedfromsucker\ntilex|"..UT.tilex.."|\ntiley|"..UT.tiley.."|\nitemtoremove|"..UT.removeItem)
                Sleep(UT.delay/2)
                SendPacket(2, "action|dialog_return\ndialog_name|drop_item\nitemID|"..UT.dropItem.."|\ncount|"..UT.dropCount)
                UT.lastActionTime = currentTime
            end
        end

        -- ADDVEND
        if ADDVEND.running then
            if (currentTime - ADDVEND.lastActionTime) >= ADDVEND.delay then
                local pkt = "action|dialog_return\n" ..
                            "dialog_name|vending\n" ..
                            "tilex|"..ADDVEND.tilex.."|\n" ..
                            "tiley|"..ADDVEND.tiley.."|\n" ..
                            "buttonClicked|addstock\n" ..
                            "setprice|"..ADDVEND.price.."\n" ..
                            "chk_perlock|"..ADDVEND.perlock.."\n" ..
                            "chk_peritem|"..ADDVEND.peritem
                SendPacket(2, pkt)
                ADDVEND.lastActionTime = currentTime
            end
        end

        -- PNB (place then break)
        if PNB.running and me then
            if PNB.state == 0 then
                if PNB.index <= PNB.far then
                    local tx = (PNB.direction == "right") and (px + PNB.index) or (px - PNB.index)
                    local ty = py
                    SendPacketRaw(false, { type = 3, value = PNB.itemId, px = tx, py = ty, x = me.pos.x, y = me.pos.y })
                    PNB.index = PNB.index + 1
                    Sleep(PNB.delay)
                else
                    PNB.state = 1
                    PNB.index = 1
                end
            elseif PNB.state == 1 then
                if PNB.index <= PNB.far then
                    local tx = (PNB.direction == "right") and (px + PNB.index) or (px - PNB.index)
                    local ty = py
                    SendPacketRaw(false, { type = 3, value = 18, px = tx, py = ty, x = me.pos.x, y = me.pos.y })
                    PNB.index = PNB.index + 1
                    Sleep(PNB.delay)
                else
                    PNB.state = 0
                    PNB.index = 1
                end
            end
        end

        -- MIRRORMAZE (stateful & pause if player nearby)
        if MIRRORMAZE.running then
            if (currentTime - MIRRORMAZE.lastActionTime) >= MIRRORMAZE.actionDelay then
                local me_local = GetLocal()
                if not me_local then MIRRORMAZE.lastActionTime = currentTime; goto mm_continue end
                local px_now = math.floor(me_local.pos.x / 32)
                local py_now = math.floor(me_local.pos.y / 32)

                local found, pname = IsOtherPlayerNearby()
                if found then
                    if not MIRRORMAZE.paused then
                        logMessage("Mirrormaze: Player detected ("..pname.."), pausing")
                        MIRRORMAZE.paused = true
                    end
                    MIRRORMAZE.lastActionTime = currentTime
                    goto mm_continue
                else
                    if MIRRORMAZE.paused then
                        logMessage("Mirrormaze: No players nearby, resuming")
                        MIRRORMAZE.paused = false
                    end
                end

                if not MIRRORMAZE.paused then
                    if MIRRORMAZE.state == 0 then
                        FindPath(MIRRORMAZE.doorX, MIRRORMAZE.doorY)
                        MIRRORMAZE.state = 1
                        MIRRORMAZE.lastActionTime = currentTime
                        MIRRORMAZE.actionDelay = 400
                    elseif MIRRORMAZE.state == 1 then
                        if px_now == MIRRORMAZE.doorX and py_now == MIRRORMAZE.doorY then
                            SendPacketRaw(false, { type = 7, value = 18, px = MIRRORMAZE.doorX, py = MIRRORMAZE.doorY })
                            MIRRORMAZE.state = 2
                            MIRRORMAZE.lastActionTime = currentTime
                            MIRRORMAZE.actionDelay = 1000
                        else
                            FindPath(MIRRORMAZE.doorX, MIRRORMAZE.doorY)
                            MIRRORMAZE.lastActionTime = currentTime
                            MIRRORMAZE.actionDelay = 300
                        end
                    elseif MIRRORMAZE.state == 2 then
                        FindPath(MIRRORMAZE.targetX, MIRRORMAZE.targetY)
                        if px_now == MIRRORMAZE.targetX and py_now == MIRRORMAZE.targetY then
                            MIRRORMAZE.state = 3
                        end
                        MIRRORMAZE.lastActionTime = currentTime
                        MIRRORMAZE.actionDelay = 400
                    elseif MIRRORMAZE.state == 3 then
                        MIRRORMAZE.count = (MIRRORMAZE.count or 0) + 1
                        logMessage("Mirrormaze: finished cycle #" .. MIRRORMAZE.count)
                        MIRRORMAZE.state = 0
                        MIRRORMAZE.lastActionTime = currentTime
                        MIRRORMAZE.actionDelay = 200
                        if MIRRORMAZE.count >= 100 then
                            logMessage("Mirrormaze: reached 100 cycles, resting 5s")
                            Sleep(5000)
                            MIRRORMAZE.count = 0
                        end
                    end
                end
                ::mm_continue::
            end
        end

        -- PLANT (zig-zag)
        if PLANT.running then
            if PLANT.currentX == nil then PLANT.currentX = PLANT.X_MIN end
            if PLANT.currentY == nil then PLANT.currentY = PLANT.Y_MIN end

            if (currentTime - PLANT.lastPlantTime) >= PLANT.plantDelay then
                if not me then PLANT.lastPlantTime = currentTime; goto plant_continue end

                -- go pick seeds if none
                if GetItemCount(PLANT.seedid) == 0 then
                    FindPath(PLANT.TakeSeed_X, PLANT.TakeSeed_Y)
                    PLANT.lastPlantTime = currentTime
                    goto plant_continue
                end

                local tile = GetTile(PLANT.currentX, PLANT.currentY)
                if tile and tile.fg == 0 then
                    if math.abs(px - PLANT.currentX) > 2 or math.abs(py - PLANT.currentY) > 2 then
                        FindPath(PLANT.currentX, PLANT.currentY)
                        Sleep(200)
                    end
                    local pkt = { type = 3, value = PLANT.seedid, px = PLANT.currentX, py = PLANT.currentY, x = me.pos.x, y = me.pos.y }
                    SendPacketRaw(false, pkt)
                    if ((PLANT.currentX + PLANT.currentY) % PLANT.logInterval) == 0 then
                        logMessage("Planted at "..PLANT.currentX..","..PLANT.currentY)
                    end
                end

                -- advance zig-zag
                if (PLANT.currentY % 2) == 0 then
                    PLANT.currentX = PLANT.currentX + 1
                    if PLANT.currentX > PLANT.X_MAX then PLANT.currentX = PLANT.X_MAX; PLANT.currentY = PLANT.currentY + 1 end
                else
                    PLANT.currentX = PLANT.currentX - 1
                    if PLANT.currentX < PLANT.X_MIN then PLANT.currentX = PLANT.X_MIN; PLANT.currentY = PLANT.currentY + 1 end
                end

                if PLANT.currentY > PLANT.Y_MAX then
                    logMessage("Plant: finished one cycle, resetting")
                    PLANT.currentX = PLANT.X_MIN; PLANT.currentY = PLANT.Y_MIN
                end

                PLANT.lastPlantTime = currentTime
                ::plant_continue::
            end
        end

        Sleep(5)
    end
end)
